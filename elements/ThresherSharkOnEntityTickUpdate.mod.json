{
  "_fv": 73,
  "_type": "procedure",
  "definition": {
    "procedurexml": "<xml xmlns=\"https://developers.google.com/blockly/xml\"><block type=\"event_trigger\" deletable=\"false\" x=\"40\" y=\"40\"><field name=\"trigger\">no_ext_trigger</field><next><block type=\"controls_if\"><mutation elseif=\"1\"></mutation><value name=\"IF0\"><block type=\"logic_binary_ops\" inline=\"false\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"logic_entity_compare\"><field name=\"entity\">CUSTOM:ThresherShark</field><value name=\"compareTo\"><block type=\"entity_from_deps\"></block></value></block></value><value name=\"B\"><block type=\"logic_negate\"><value name=\"BOOL\"><block type=\"entity_isinwater_orbubblecolumn\"><value name=\"entity\"><block type=\"entity_from_deps\"></block></value></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"wait\"><value name=\"ticks\"><block type=\"math_number\"><field name=\"NUM\">600</field></block></value><statement name=\"do\"><block type=\"entity_add_potion_advanced\"><field name=\"potion\">CUSTOM:DryoutEffect</field><value name=\"level\"><block type=\"math_number\"><field name=\"NUM\">0</field></block></value><value name=\"duration\"><block type=\"math_number\"><field name=\"NUM\">600</field></block></value><value name=\"ambient\"><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value><value name=\"particles\"><block type=\"logic_boolean\"><field name=\"BOOL\">FALSE</field></block></value><value name=\"entity\"><block type=\"entity_from_deps\"></block></value></block></statement></block></statement><value name=\"IF1\"><block type=\"entity_isinwater_orbubblecolumn\"><value name=\"entity\"><block type=\"entity_from_deps\"></block></value></block></value><statement name=\"DO1\"><block type=\"entity_remove_specific_potion_effect\"><field name=\"potion\">CUSTOM:DryoutEffect</field><value name=\"entity\"><block type=\"entity_from_deps\"></block></value></block></statement><next><block type=\"controls_if\"><value name=\"IF0\"><block type=\"logic_binary_ops\" inline=\"false\"><field name=\"OP\">AND</field><value name=\"A\"><block type=\"logic_entity_compare\"><field name=\"entity\">CUSTOM:ThresherShark</field><value name=\"compareTo\"><block type=\"entity_from_deps\"></block></value></block></value><value name=\"B\"><block type=\"entity_isinwater_orbubblecolumn\"><value name=\"entity\"><block type=\"entity_from_deps\"></block></value></block></value></block></value><statement name=\"DO0\"><block type=\"controls_if\"><mutation else=\"1\"></mutation><value name=\"IF0\"><block type=\"logic_binary_ops\"><field name=\"OP\">EQ</field><value name=\"A\"><block type=\"entity_nbt_logic_get\"><value name=\"entity\"><block type=\"entity_from_deps\"></block></value><value name=\"tagName\"><block type=\"text\"><field name=\"TEXT\">Sprinting</field></block></value></block></value><value name=\"B\"><block type=\"logic_boolean\"><field name=\"BOOL\">TRUE</field></block></value></block></value><statement name=\"DO0\"><block type=\"play_newgeckoanim\"><field name=\"name\">CUSTOM:ThresherShark</field><value name=\"entity\"><block type=\"entity_from_deps\"></block></value><value name=\"animation\"><block type=\"text\"><field name=\"TEXT\">sprint</field></block></value></block></statement><statement name=\"ELSE\"><block type=\"stop_procedure\"><field name=\"name\">CUSTOM:ThresherShark</field><value name=\"entity\"><block type=\"entity_from_deps\"></block></value></block></statement></block></statement><next><block type=\"java_code\"><field name=\"CODE\">// Cast to ThresherSharkEntity&amp;#10;if (entity instanceof net.mcreator.sharks.entity.ThresherSharkEntity shark) {&amp;#10;&amp;#10;    // --- 1. CLIENT SYNC BRIDGE ---&amp;#10;    String syncedAnim = shark.getSyncedAnimation();&amp;#10;    if (\"whip\".equals(syncedAnim)) {&amp;#10;        shark.animationprocedure = \"whip\";&amp;#10;    }&amp;#10;&amp;#10;    // --- 2. SERVER LOGIC ---&amp;#10;    if (!world.isClientSide()) {&amp;#10;        &amp;#10;        // [Normal Bite Sound Logic Omitted - Keep your existing sound logic here]&amp;#10;        if (shark.swingTime == 1) {&amp;#10;             // ...&amp;#10;        }&amp;#10;&amp;#10;        double cooldown = entity.getPersistentData().getDouble(\"WhipCooldown\");&amp;#10;        double timer = entity.getPersistentData().getDouble(\"WhipTimer\");&amp;#10;&amp;#10;        if (cooldown &gt; 0) entity.getPersistentData().putDouble(\"WhipCooldown\", cooldown - 1);&amp;#10;&amp;#10;        if (timer &gt; 0) {&amp;#10;            entity.getPersistentData().putDouble(\"WhipTimer\", timer - 1);&amp;#10;&amp;#10;            // A. LOCK ANIMATION&amp;#10;            if (timer &gt; 1) {&amp;#10;                if (!\"whip\".equals(syncedAnim)) shark.setAnimation(\"whip\");&amp;#10;                if (entity instanceof net.minecraft.world.entity.LivingEntity living) {&amp;#10;                    living.addEffect(new net.minecraft.world.effect.MobEffectInstance(net.minecraft.world.effect.MobEffects.MOVEMENT_SLOWDOWN, 5, 10, false, false));&amp;#10;                }&amp;#10;            } else {&amp;#10;                shark.setAnimation(\"undefined\"); &amp;#10;            }&amp;#10;&amp;#10;            // B. DAMAGE EVENT (Tick 5)&amp;#10;            if (timer == 5) {&amp;#10;                // --- FLAG START: THIS IS WHIP DAMAGE ---&amp;#10;                entity.getPersistentData().putBoolean(\"WhipHitFrame\", true);&amp;#10;                &amp;#10;                double baseDamage = shark.getAttribute(net.minecraft.world.entity.ai.attributes.Attributes.ATTACK_DAMAGE).getValue();&amp;#10;                net.minecraft.world.damagesource.DamageSource damageSource = shark.damageSources().mobAttack(shark);&amp;#10;                &amp;#10;                net.minecraft.world.phys.AABB box = entity.getBoundingBox().inflate(5);&amp;#10;                java.util.List&lt;net.minecraft.world.entity.LivingEntity&gt; targets = world.getEntitiesOfClass(net.minecraft.world.entity.LivingEntity.class, box);&amp;#10;&amp;#10;                for (net.minecraft.world.entity.LivingEntity vic : targets) {&amp;#10;                    if (vic != entity &amp;&amp; vic.isAlive() &amp;&amp; !vic.isInvulnerable() &amp;&amp; entity.distanceToSqr(vic) &lt;= 25) {&amp;#10;                        net.minecraft.world.phys.Vec3 lookDir = entity.getViewVector(1.0F).normalize();&amp;#10;                        net.minecraft.world.phys.Vec3 vicDir = vic.position().subtract(entity.position()).normalize();&amp;#10;                        &amp;#10;                        if (lookDir.dot(vicDir) &gt; 0.3) {&amp;#10;                             vic.hurt(damageSource, (float) (baseDamage * 2));&amp;#10;                             vic.knockback(2.5, entity.getX() - vic.getX(), entity.getZ() - vic.getZ());&amp;#10;                             &amp;#10;                             if (world instanceof net.minecraft.world.level.Level _level) {&amp;#10;                                 _level.playSound(null, vic.blockPosition(), net.minecraftforge.registries.ForgeRegistries.SOUND_EVENTS.getValue(new net.minecraft.resources.ResourceLocation(\"entity.player.attack.knockback\")), net.minecraft.sounds.SoundSource.HOSTILE, 1, 1);&amp;#10;                             }&amp;#10;                        }&amp;#10;                    }&amp;#10;                }&amp;#10;                &amp;#10;                // --- FLAG END: TURN IT OFF IMMEDIATELY ---&amp;#10;                entity.getPersistentData().putBoolean(\"WhipHitFrame\", false);&amp;#10;            }&amp;#10;        } &amp;#10;        &amp;#10;        // --- TRIGGER PHASE ---&amp;#10;        else if (cooldown == 0 &amp;&amp; shark.getTarget() != null) {&amp;#10;            net.minecraft.world.entity.LivingEntity target = shark.getTarget();&amp;#10;            if (target.isAlive() &amp;&amp; entity.distanceToSqr(target) &lt;= 16) {&amp;#10;                shark.setAnimation(\"whip\");&amp;#10;                entity.getPersistentData().putDouble(\"WhipTimer\", 20);&amp;#10;                entity.getPersistentData().putDouble(\"WhipCooldown\", 100);&amp;#10;            }&amp;#10;        }&amp;#10;    }&amp;#10;}</field></block></next></block></next></block></next></block></xml>"
  }
}